<!DOCTYPE html>
<html lang="en"><head>
<script src="L04_Non-linearModels_files/libs/clipboard/clipboard.min.js"></script>
<script src="L04_Non-linearModels_files/libs/quarto-html/tabby.min.js"></script>
<script src="L04_Non-linearModels_files/libs/quarto-html/popper.min.js"></script>
<script src="L04_Non-linearModels_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="L04_Non-linearModels_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="L04_Non-linearModels_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="L04_Non-linearModels_files/libs/quarto-html/quarto-syntax-highlighting-dark-8b864f0777c60eecff11d75b6b2e1175.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.33">

  <meta name="author" content="FW8051 Statistics for Ecologists">
  <title>Modeling Non-linear relationships</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="L04_Non-linearModels_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="L04_Non-linearModels_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="L04_Non-linearModels_files/libs/revealjs/dist/theme/quarto-c89a7e063782379d64767b77f736f9e1.css">
  <link href="L04_Non-linearModels_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="L04_Non-linearModels_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="L04_Non-linearModels_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="L04_Non-linearModels_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="L04_Non-linearModels_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="L04_Non-linearModels_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Modeling Non-linear relationships</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
FW8051 Statistics for Ecologists 
</div>
</div>
</div>

</section>
<section id="modeling-non-linear-relationships" class="slide level2">
<h2>Modeling Non-linear relationships</h2>
<p>Learning objectives:</p>
<ul>
<li><p>Be able to implement common approaches for modeling non-linear relationships between <span class="math inline">\(X_i\)</span> and <span class="math inline">\(Y_i\)</span></p>
<ul>
<li>Polynomials using the <code>poly</code> function in R</li>
<li>Splines using the <code>ns</code> function (splines library)</li>
<li>Smoothing splines</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Understand how model predictions are constructed when using polynomials or splines</li>
</ul>
</div>
</section>
<section id="mallard-clutch-size-versus-julian-date" class="slide level2">
<h2>Mallard clutch size versus Julian Date</h2>
<div class="columns">
<div class="column" style="width:75%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Graphics/clutchnl.jpg" class="quarto-figure quarto-figure-center" style="width:90.0%" alt="Scatterplot of clutch size of mallards nesting in nest boxes in Minnesota versus nest initiation date. Clutch size decreases with nest initiation date, but doesn't follow a linear trend for large initiation dates."></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:20%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Graphics/clutch.jpg" class="quarto-figure quarto-figure-center" style="width:100.0%" alt="Picture of duck eggs"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="age-specific-hazard-for-white-tailed-deer" class="slide level2">
<h2>Age-specific Hazard for White-tailed Deer</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Graphics/survnl.jpg" class="quarto-figure quarto-figure-center" style="width:90.0%" alt="Bathbub shaped mortality hazard for white-tailed deer, with the highest risk of death for the youngest and oldest individuals."></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Graphics/deer.png" class="quarto-figure quarto-figure-center" alt="Picture of a white-tailed deer in deep snow." width="148"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="section" class="slide level2">
<h2></h2>

<img data-src="Graphics/Thompson.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%" alt="Picture of a white-tailed deer in deep snow."></section>
<section id="linear-models" class="slide level2">
<h2>Linear Models</h2>
<p>So far, we have focused on <em>linear models</em> of the form:</p>
<p><span class="math inline">\(Y_i = \beta_0 + X_i\beta + \epsilon_i\)</span></p>
<p>or</p>
<p><span class="math inline">\(Y_i = \beta_0 + X_{i,1}\beta_1 + X_{i,2}\beta_2 + \ldots + \epsilon_i\)</span></p>
<p>The model can be written as a “linear combination” of parameters.</p>
</section>
<section id="species-area-relationship" class="slide level2">
<h2>Species-Area relationship</h2>
<p>Plant species richness for 29 islands in the Galapagos Islands archipelago (Johnson and Raven 1973)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gala, <span class="fu">aes</span>(<span class="at">x=</span>logarea, <span class="at">y=</span>Species)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)  <span class="sc">+</span> </span>
<span id="cb1-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log Area"</span>)<span class="sc">+</span> <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="L04_Non-linearModels_files/figure-revealjs/sparga-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:80.0%" alt="Plot of plant species richness versus log area for 29 islands in the Galapagos Islands archipelago. The relationship is non-linear, but we see more species on larger islands."></section>
<section id="modeling-non-linear-relationships-1" class="slide level2">
<h2>Modeling Non-Linear Relationships</h2>
<ul>
<li>Polynomials (e.g., poly(age,2) for a quadratic in age)<br>
</li>
<li>Transformations of <span class="math inline">\(X\)</span> or <span class="math inline">\(Y\)</span> (e.g., log(<span class="math inline">\(X\)</span>), <span class="math inline">\(\sqrt{Y}\)</span>, <span class="math inline">\(exp(X)\)</span>).<br>
</li>
<li>Regression splines</li>
</ul>
<p>These options still lead to <em>linear models</em>:</p>
<p><span class="math inline">\(Y_i = \beta_0 + X_i\beta_1 + X^2_i\beta_2+ \ldots + \epsilon_i\)</span></p>
<p><span class="math inline">\(\sqrt{Y_i} = \beta_0 + log(X_i)\beta_1 + \ldots + \epsilon_i\)</span></p>
<div class="fragment">
<p>So, we can use all the same tools we’ve learned about (e.g., residual plots, t-tests, F-tests, AIC, etc) [note: try writing out the above models in matrix notation!]</p>
</div>
</section>
<section id="species-area-relationship-1" class="slide level2">
<h2>Species-Area relationship</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gala, <span class="fu">aes</span>(<span class="at">x=</span>logarea, <span class="at">y=</span>Species)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb2-2"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>), <span class="at">se=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb2-3"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-10-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:80.0%" alt="Plot of plant species richness versus log area for 29 islands in the Galapagos Islands archipelago. The relationship is non-linear, but we see more species on larger islands. This relationship is well described by a polynomial."></section>
<section id="polynomials" class="slide level2">
<h2>Polynomials</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a>gala<span class="sc">$</span>logarea.squared<span class="ot">&lt;-</span>gala<span class="sc">$</span>logarea<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-2"><a href="" aria-hidden="true" tabindex="-1"></a>lm.poly<span class="ot">&lt;-</span><span class="fu">lm</span>(Species<span class="sc">~</span> logarea <span class="sc">+</span> logarea.squared, <span class="at">data=</span>gala)</span>
<span id="cb3-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Species ~ logarea + logarea.squared, data = gala)

Residuals:
     Min       1Q   Median       3Q      Max 
-151.009  -27.361   -1.033   20.825  178.805 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      14.1530    14.5607   0.972 0.340010    
logarea          12.6226     4.8614   2.596 0.015293 *  
logarea.squared   3.5641     0.9445   3.773 0.000842 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 59.88 on 26 degrees of freedom
Multiple R-squared:  0.7528,    Adjusted R-squared:  0.7338 
F-statistic:  39.6 on 2 and 26 DF,  p-value: 1.285e-08</code></pre>
</div>
</div>
</section>
<section id="polynomials-1" class="slide level2">
<h2>Polynomials</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a>lm.poly1.raw<span class="ot">&lt;-</span><span class="fu">lm</span>(Species<span class="sc">~</span> <span class="fu">poly</span>(logarea,<span class="dv">2</span>, <span class="at">raw=</span><span class="cn">TRUE</span>), <span class="at">data=</span>gala)</span>
<span id="cb5-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.poly1.raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Species ~ poly(logarea, 2, raw = TRUE), data = gala)

Residuals:
     Min       1Q   Median       3Q      Max 
-151.009  -27.361   -1.033   20.825  178.805 

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                    14.1530    14.5607   0.972 0.340010    
poly(logarea, 2, raw = TRUE)1  12.6226     4.8614   2.596 0.015293 *  
poly(logarea, 2, raw = TRUE)2   3.5641     0.9445   3.773 0.000842 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 59.88 on 26 degrees of freedom
Multiple R-squared:  0.7528,    Adjusted R-squared:  0.7338 
F-statistic:  39.6 on 2 and 26 DF,  p-value: 1.285e-08</code></pre>
</div>
</div>
</section>
<section id="polynomials-component-residual-plot" class="slide level2">
<h2>Polynomials: component + residual plot</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a>lm.poly1.raw<span class="ot">&lt;-</span><span class="fu">lm</span>(Species<span class="sc">~</span> <span class="fu">poly</span>(logarea,<span class="dv">2</span>), <span class="at">data=</span>gala)</span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">termplot</span>(lm.poly1.raw, <span class="at">se=</span>T, <span class="at">partial=</span>T, <span class="at">pch=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-13-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:80.0%" alt="Relationship between plant species richness and log area for 29 islands in the Galapagos Islands archipelago described by a piecewise linear regression model."></section>
<section id="hypothesis-testing" class="slide level2">
<h2>Hypothesis Testing</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb8-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(lm.poly) <span class="co">#log(Area)+ I(log(Area)^2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type II tests)

Response: Species
                Sum Sq Df F value    Pr(&gt;F)    
logarea          24175  1  6.7417 0.0152925 *  
logarea.squared  51058  1 14.2387 0.0008418 ***
Residuals        93232 26                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(lm.poly1.raw) <span class="co"># poly(logarea,2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type II tests)

Response: Species
                 Sum Sq Df F value    Pr(&gt;F)    
poly(logarea, 2) 283970  2  39.596 1.285e-08 ***
Residuals         93232 26                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</div>
</section>
<section id="basis-functionsvectors" class="slide level2" style="font-size: 80%;">
<h2>Basis functions/vectors</h2>
<p>A <em>linear model</em> is a model that is linear in the parameters:</p>
<p><span class="math inline">\(Y_i = \sum_{j=1}^P \beta_j b_j(X_i) + \epsilon_i\)</span></p>
<p>The <span class="math inline">\(b_j(X_i)\)</span> are called <span style="color:red;">basis functions</span> or <span style="color:red;">basis vectors</span>.</p>
<div class="fragment">
<p><span class="math inline">\(Y_i = \beta_0 + \beta_2X_i + \beta_3X_i^2 + \ldots + \epsilon_i\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(b_j(X_i) = 1, X, X^2, X^3, \ldots\)</span></p>
</div>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">model.matrix</span>(Species<span class="sc">~</span> <span class="fu">poly</span>(logarea,<span class="dv">2</span>, <span class="at">raw=</span><span class="cn">TRUE</span>), <span class="at">data=</span>gala))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept) poly(logarea, 2, raw = TRUE)1 poly(logarea, 2, raw = TRUE)2
1           1                     3.2224694                   10.38430878
2           1                     0.2151114                    0.04627291
3           1                    -1.5606477                    2.43562139
4           1                    -2.3025851                    5.30189811
5           1                    -2.9957323                    8.97441185
6           1                    -1.0788097                    1.16383029</code></pre>
</div>
</div>
</section>
<section id="basis-functions" class="slide level2">
<h2>Basis functions</h2>
<p><span class="math inline">\(E[Y_i|X_i] = \beta_01 + \beta_2X_i + \beta_3X_i^2\)</span></p>

<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-17-1.png" class="quarto-figure quarto-figure-center r-stretch" alt="Plots of the basis functions (1, log(area), log(area) squared) versus log area. These give a horizontal line, a 1-1 line, and a quadratic polynomial." width="480"><p><span class="math inline">\(E[Y | X]\)</span> is given by a linear combination of a horizontal line (1), a line through the origin (<span class="math inline">\(X\)</span>), a quadratic centered on the origin (<span class="math inline">\(X^2\)</span>).</p>
</section>
<section id="species-area-relationship-2" class="slide level2">
<h2>Species-Area relationship</h2>
<p><span class="math inline">\(Species_i = 14.15 + 12.62X_i + 3.56X^2_i\)</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gala, <span class="fu">aes</span>(<span class="at">x=</span>logarea, <span class="at">y=</span>Species)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb14-2"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>, <span class="at">raw=</span><span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-18-1.png" class="quarto-figure quarto-figure-center r-stretch" alt="Plot of predicted species richness from the quadratic polynomial." width="480"></section>
<section id="polynomials-2" class="slide level2">
<h2>Polynomials</h2>
<p>A <span style="color:red;">polynomial of degree D</span> is a function formed by linear combinations of the powers of its argument up to D:</p>
<p><span class="math inline">\(y = \beta_0 + \beta_1x + \beta_2x^2 + \ldots + \beta_Dx^D\)</span></p>
<p>Specific polynomials:</p>
<ul>
<li>Linear: <span class="math inline">\(y = \beta_0 + \beta_1x\)</span></li>
<li>Quadratic:: <span class="math inline">\(y = \beta_0 + \beta_1x + \beta_2x^2\)</span></li>
<li>Cubic: <span class="math inline">\(y = \beta_0 + \beta_1x + \beta_2x^2 + \beta_3x^3\)</span></li>
<li>Quartic: <span class="math inline">\(y = \beta_0 + \beta_1x + \beta_2x^2 + \beta_3x^3+\beta_4x^4\)</span></li>
<li>Quintic: <span class="math inline">\(y = \beta_0 + \beta_1x + \beta_2x^2 + \beta_3x^3+\beta_4x^4 + \beta_5x^5\)</span></li>
</ul>
</section>
<section id="polynomials-3" class="slide level2" style="font-size: 80%;">
<h2>Polynomials</h2>
<p>The <span style="color:red;">design matrix</span> for a regression model with <span class="math inline">\(n\)</span> observations and <span class="math inline">\(p\)</span> predictors is the matrix with <span class="math inline">\(n\)</span> rows and <span class="math inline">\(p\)</span> columns such that the value of the <span class="math inline">\(j^{th}\)</span> predictor for the <span class="math inline">\(i^{th}\)</span> observation is located in column <span class="math inline">\(j\)</span> of row <span class="math inline">\(i\)</span>.</p>
<p><strong>Design matrix for a polynomial of degree D</strong></p>
<p><span class="math inline">\(\begin{bmatrix}
   1 &amp; x_1 &amp; x_1^2 &amp; x_1^3 &amp; ... &amp; x_1^D \\
   1 &amp; x_2 &amp; x_2^2 &amp; x_2^3 &amp; ... &amp; x_2^D \\
   1 &amp; x_3 &amp; x_3^2 &amp; x_3^3 &amp; ... &amp; x_3^D \\
    &amp; &amp; \vdots &amp; &amp; \\
    1 &amp; x_n &amp; x_n^2 &amp; x_n^3 &amp; ... &amp; x_n^D \\
\end{bmatrix}\)</span></p>
</section>
<section id="polynomials-4" class="slide level2">
<h2>Polynomials</h2>

<img data-src="Graphics/poly.png" class="quarto-figure quarto-figure-center r-stretch" alt="Picture of polynomials of different degrees." width="600"></section>
<section id="orthogonal-polynomials" class="slide level2">
<h2>Orthogonal Polynomials</h2>
<p>Standard polynomials can cause numerical issues due to differences in scale:</p>
<p><span class="math inline">\(X = 100\)</span> <span class="math inline">\(x^3 = 1,000,000\)</span></p>
<div class="fragment">
<p>Centering and scaling <span class="math inline">\(X\)</span> can help.</p>
</div>
<div class="fragment">
<p>Alternatively, we can use “orthogonal polynomials” created using <code>poly(raw=FALSE)</code> (the default). See Section 4.10 in the book.</p>
</div>
</section>
<section>
<section id="splines" class="title-slide slide level1 center">
<h1>Splines</h1>

</section>
<section id="species-area-relationship-3" class="slide level2">
<h2>Species-Area relationship</h2>
<p>Linear models are often a good approximation over small ranges of <span class="math inline">\(x\)</span>.</p>

<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-23-1.png" class="quarto-figure quarto-figure-center r-stretch" alt="Piecewise linear model relating plant species richness to log(Area) for 29 islands in the Galapagos Islands archipelago. The model has 3 separate slopes of increasing positive magnitude, one from log(area) values ranging from -infinity to 1, one from 1 to 4.2, and one for values greater than 4.2." width="480"></section>
<section id="splines-1" class="slide level2">
<h2>Splines</h2>
<p><span style="color:red;">Splines</span> are piecewise polynomials used in curve fitting.</p>
<div class="fragment">
<p>A <span style="color:red;">linear spline</span> is a continuous function formed by connecting linear segments. The points where the segments connect are called the <span style="color:red;">knots</span> of the spline.</p>
</div>
</section>
<section id="linear-spline-with-knots-at-1-and-4.2" class="slide level2">
<h2>Linear spline with knots at 1 and 4.2</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="" aria-hidden="true" tabindex="-1"></a>gala<span class="sc">$</span>logarea<span class="ot">&lt;-</span> <span class="fu">log</span>(gala<span class="sc">$</span>Area)</span>
<span id="cb15-2"><a href="" aria-hidden="true" tabindex="-1"></a>gala<span class="sc">$</span>logarea<span class="fl">.1</span><span class="ot">&lt;-</span> <span class="fu">ifelse</span>(gala<span class="sc">$</span>logarea<span class="sc">&lt;</span><span class="dv">1</span>, <span class="dv">0</span>, gala<span class="sc">$</span>logarea<span class="dv">-1</span>)</span>
<span id="cb15-3"><a href="" aria-hidden="true" tabindex="-1"></a>gala<span class="sc">$</span>logarea.<span class="fl">4.2</span><span class="ot">&lt;-</span> <span class="fu">ifelse</span>(gala<span class="sc">$</span>logarea<span class="sc">&lt;</span><span class="fl">4.2</span>, <span class="dv">0</span>, gala<span class="sc">$</span>logarea<span class="fl">-4.2</span>) </span>
<span id="cb15-4"><a href="" aria-hidden="true" tabindex="-1"></a>lm.sp<span class="ot">&lt;-</span><span class="fu">lm</span>(Species<span class="sc">~</span>logarea<span class="sc">+</span>logarea<span class="fl">.1</span><span class="sc">+</span>logarea.<span class="fl">4.2</span>, <span class="at">data=</span>gala)</span>
<span id="cb15-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Species ~ logarea + logarea.1 + logarea.4.2, data = gala)

Residuals:
     Min       1Q   Median       3Q      Max 
-160.691  -16.547   -4.209   13.133  166.430 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)   23.869     17.384   1.373   0.1819  
logarea        5.213      8.956   0.582   0.5658  
logarea.1     17.464     18.836   0.927   0.3627  
logarea.4.2   44.815     23.156   1.935   0.0643 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 58.97 on 25 degrees of freedom
Multiple R-squared:  0.7695,    Adjusted R-squared:  0.7418 
F-statistic: 27.82 on 3 and 25 DF,  p-value: 3.934e-08</code></pre>
</div>
</div>
</section>
<section id="basis-functions-1" class="slide level2">
<h2>Basis functions</h2>

<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-26-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:95.0%" alt="Basis vectors, weighted basis vectors, and predicted values formed by summing the weighted basis vectors in the linear spline model relating plant species richness to log(Area) for 29 islands in the Galapagos Islands archipelago."><ul>
<li>Left = Basis Functions</li>
<li>Middle = Basis Functions * regression coefficient</li>
<li>Right = Fitted Model</li>
</ul>
</section>
<section id="splines-2" class="slide level2">
<h2>Splines</h2>
<p>A <span style="color:red;">spline of degree D</span> is a function formed by connecting polynomial segments of degree D so that:</p>
<ul>
<li>the function is continuous (no `jumps’)<br>
</li>
<li>the function has D-1 continuous derivatives<br>
</li>
<li>the D<span class="math inline">\(^{th}\)</span> derivative is constant between knots</li>
</ul>
<p>Linear splines (D = 1): first derivative is not constant (can go from increasing to decreasing at a knot)</p>
</section>
<section id="cubic-regression-splines" class="slide level2">
<h2>Cubic Regression Splines</h2>
<ul>
<li><p>Fits a cubic polynomial on segments of the data<br>
</p></li>
<li><p>D-1 = 2 continuous derivatives everywhere (even at the knot locations)</p>
<ul>
<li>the first derivative (tells us if the function is increasing or decreasing) is continuous (even at the knots)</li>
<li>the second derivative (tell us about curvature) is constant (even at the knots)</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Ensures that the fit is “smooth” at the connections (knot locations)</li>
</ul>
</div>
</section>
<section id="truncated-power-basis" class="slide level2">
<h2>Truncated Power Basis</h2>
<p>The <span style="color:red;">truncated polynomial</span> of degree D associated with a knot <span class="math inline">\(\xi_k\)</span> is the function which is equal to 0 to the left of <span class="math inline">\(\xi_k\)</span> and equal to <span class="math inline">\((x - \xi_k)^D\)</span> to the right of <span class="math inline">\(\xi_k\)</span>.</p>
<p><span class="math inline">\((x - \xi_k)^D_+ =  \left\{ \begin{array}{ll}
0 &amp; \mbox{if } x &lt; \xi_k\\
(x - \xi_k)^D &amp; \mbox{if } x \ge \xi_k
\end{array}
\right.\)</span></p>
<div class="fragment">
<p><br></p>
<p>The equation for a spline of degree D with K knots is:</p>
<p><span class="math inline">\(y = \beta_0 +\sum_{d=1}^D \beta_Dx^d + \sum_{k=1}^K b_k(x - \xi_k)^D_+\)</span></p>
</div>
</section>
<section id="splines-3" class="slide level2">
<h2>Splines</h2>
<p>The design matrix for a cubic spline with K knots is the n by 1 + 3 + K matrix with entries:</p>
<p><span class="math inline">\(\begin{bmatrix}
   1 &amp; x_1 &amp; x_1^2 &amp; x_1^3  &amp; (x_1 - \xi_1)^3_+ &amp; ... &amp; (x_1 - \xi_k)^3_+\\
   1 &amp; x_2 &amp; x_2^2 &amp; x_2^3  &amp; (x_2 - \xi_1)^3_+ &amp; ... &amp; (x_2 - \xi_k)^3_+\\
   1 &amp; x_3 &amp; x_3^2 &amp; x_3^3  &amp; (x_3 - \xi_1)^3_+ &amp; ... &amp; (x_3 - \xi_k)^3_+\\
    &amp; &amp; \vdots &amp; &amp; \\
    1 &amp; x_n &amp; x_n^2 &amp; x_n^3  &amp; (x_n - \xi_1)^3_+ &amp; ... &amp; (x_n - \xi_k)^3_+\\
\end{bmatrix}\)</span></p>
</section>
<section id="basis-functions-splines" class="slide level2 smaller">
<h2>Basis functions: Splines</h2>
<p>Truncated power basis:</p>
<ul>
<li>Easiest to understand, but may run into numerical problems due to scaling issues</li>
</ul>
<div class="fragment">
<p>Bsplines ( in splines package)</p>
<ul>
<li>Numerically more stable than those based on the truncated power basis</li>
<li>Can be poorly behaved in the tails</li>
</ul>
</div>
<div class="fragment">
<p>Natural or restricted cubic splines ( in splines package; in rcs package)</p>
<ul>
<li>Fit is constrained to be linear before the first knot and after the last knot (these are refered to as )</li>
<li>Requires fewer model df (number of knots -1 = number of interior knots + 1)</li>
</ul>
</div>
</section>
<section id="span-splines" class="slide level2">
<h2>Span: Splines</h2>

<img data-src="Graphics/splinespan.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:90.0%" alt="Illustration of the types of smooth functions that can be approximated using splines with varying numbers of knots.  As the number of knots increase, more complex functions that can be approximated."></section>
<section id="natural-splines" class="slide level2">
<h2>Natural Splines</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="" aria-hidden="true" tabindex="-1"></a>lm.ns<span class="ot">&lt;-</span><span class="fu">lm</span>(Species<span class="sc">~</span> <span class="fu">ns</span>(logarea,<span class="at">df=</span><span class="dv">3</span>), <span class="at">data=</span>gala)</span>
<span id="cb17-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.ns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Species ~ ns(logarea, df = 3), data = gala)

Residuals:
     Min       1Q   Median       3Q      Max 
-156.173  -13.819   -5.998   13.922  170.555 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             1.468     43.542   0.034   0.9734    
ns(logarea, df = 3)1   47.790     45.957   1.040   0.3084    
ns(logarea, df = 3)2  276.125    102.146   2.703   0.0122 *  
ns(logarea, df = 3)3  381.743     45.084   8.467 8.22e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 59.48 on 25 degrees of freedom
Multiple R-squared:  0.7655,    Adjusted R-squared:  0.7374 
F-statistic: 27.21 on 3 and 25 DF,  p-value: 4.859e-08</code></pre>
</div>
</div>
</section>
<section id="natural-splines-basis-vectors" class="slide level2">
<h2>Natural Splines: Basis Vectors</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-nssplinebasis" class="quarto-float quarto-figure quarto-figure-center" data-fig-align="center" alt="Plot of the basis vectors used in the fitting of the natural cubic regression spline model relating plant species richness to log(Area) for 29 islands in the Galapagos Islands archipelago against log area. The 3 spline basis vectors are highly non-linear." width="95%">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-nssplinebasis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="L04_Non-linearModels_files/figure-revealjs/fig-nssplinebasis-1.png" id="fig-nssplinebasis" class="quarto-figure quarto-figure-center" style="width:95.0%" alt="Plot of the basis vectors used in the fitting of the natural cubic regression spline model relating plant species richness to log(Area) for 29 islands in the Galapagos Islands archipelago against log area. The 3 spline basis vectors are highly non-linear.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-nssplinebasis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">ns</span>(gala<span class="sc">$</span>logarea,<span class="dv">3</span>), <span class="st">"knots"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.09393711  3.20877345</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">ns</span>(gala<span class="sc">$</span>logarea,<span class="dv">3</span>), <span class="st">"Boundary.knots"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4.605170  8.448769</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(gala<span class="sc">$</span>logarea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4.605170  8.448769</code></pre>
</div>
</div>
</div></div>
</section>
<section id="natural-splines-1" class="slide level2">
<h2>Natural Splines</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gala, <span class="fu">aes</span>(<span class="at">x =</span> logarea, <span class="at">y =</span> Species)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb25-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb25-3"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="dv">3</span>),</span>
<span id="cb25-4"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Spline Model"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">500</span>))</span>
<span id="cb25-5"><a href="" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gala, <span class="fu">aes</span>(<span class="at">x =</span> logarea, <span class="at">y =</span> Species)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb25-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb25-7"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>),</span>
<span id="cb25-8"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Polynomial Model"</span>)<span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">500</span>))</span>
<span id="cb25-9"><a href="" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(a, b, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-33-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:95.0%" alt="Comparison of predicted values from the  natural cubic regression spline and polynomial models fit to plant species richness data collected from 29 islands in the Galapagos Islands archipelago. The spline model results in a flatter relationship near the boundary (i.e., for low log(area) values)."></section>
<section id="natural-splines-2" class="slide level2">
<h2>Natural Splines</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">termplot</span>(lm.ns, <span class="at">se=</span>T, <span class="at">partial=</span>T, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">main=</span><span class="st">"Partial Residual Plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="L04_Non-linearModels_files/figure-revealjs/unnamed-chunk-34-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:65.0%" alt="Partial residual plot showing the non-linear effect of log(area) on species richness, with partial residuals overlayed."></section>
<section id="compare-fit-to-that-of-linear-model" class="slide level2">
<h2>Compare fit to that of linear model</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="" aria-hidden="true" tabindex="-1"></a>lmfit<span class="ot">&lt;-</span><span class="fu">lm</span>(Species<span class="sc">~</span> logarea, <span class="at">data=</span>gala)</span>
<span id="cb27-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(lmfit, lm.poly1.raw, lm.sp, lm.ns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             df      AIC
lmfit         3 335.1547
lm.poly1.raw  4 324.4895
lm.sp         5 324.4646
lm.ns         5 324.9600</code></pre>
</div>
</div>
<p>Any and all approaches fit better than a linear model!</p>
</section>
<section id="number-of-knots-and-their-locations" class="slide level2">
<h2>Number of knots and their locations</h2>
<p>The shape of a spline can be controlled by carefully choosing the number of knots and their exact locations in order to:</p>
<ul>
<li>Allow flexibility where the trend changes quickly, and<br>
</li>
<li>Avoid overfitting where the trend changes little.</li>
</ul>
<div class="fragment">
<p>Could in principle compare models (e.g., using AIC) that have varying numbers of knots, or different knot locations</p>
<ul>
<li>Danger of overfitting, and difficult to account for model-selection uncertainty</li>
</ul>
</div>
</section>
<section id="number-of-knots-and-their-locations-1" class="slide level2" style="font-size: 80%;">
<h2>Number of knots and their locations</h2>
<p>Choose a small number of knots (df), based on how much data you have and how complex you expect the relationship to be <em>a priori</em></p>
<ul>
<li>I’ve found that 2 or 3 internal knots are usually sufficient for small data sets</li>
<li>Keele (2008), cited in Zuur et al, recommend 3 knots if <span class="math inline">\(n &lt; 30\)</span> and 5 knots if <span class="math inline">\(n &gt; 100\)</span></li>
</ul>
<div class="fragment">
<p>Choose knot locations based on quantiles (what <code>ns</code> does by default if you do not provide knot locations)</p>
<ul>
<li>Models fit with <em>cubic</em> regression splines are <em>usually</em> not too sensitive to knot locations</li>
</ul>
</div>
</section>
<section id="knots" class="slide level2">
<h2>Knots</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">ns</span>(gala<span class="sc">$</span>logarea,<span class="dv">3</span>), <span class="st">"knots"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.09393711  3.20877345</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">ns</span>(gala<span class="sc">$</span>logarea,<span class="dv">3</span>), <span class="st">"Boundary.knots"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4.605170  8.448769</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(gala<span class="sc">$</span>logarea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4.605170  8.448769</code></pre>
</div>
</div>
</section>
<section id="generalized-additive-models" class="slide level2">
<h2>Generalized Additive Models</h2>
<p>See Section 4.7 of the book.</p>
<p><span class="math inline">\(E[Y|X] = \beta_0 + f(x_1)\)</span></p>
<p>where <span class="math inline">\(f(x_1)\)</span> can be modeled in a variety of ways</p>
<ul>
<li>Smoothing splines<br>
</li>
<li>Loess (locally weighted linear regression)</li>
</ul>
</section>
<section id="smoothing-or-penalized-splines" class="slide level2">
<h2>Smoothing or Penalized Splines</h2>
<p><span style="color:red;">Smoothing splines</span>: Use lots of knots, but then attempt to balance overfitting and smoothness.</p>
<div class="fragment">
<p>This balance can be accomplished by controlling the <strong>size</strong> of the spline coefficients (which reflect changes in the function over different portions of the data range).</p>
</div>
<div class="fragment">
<p><br></p>
<p>See book for short illustration using the <code>mgcv</code> package. <!---
## Smoothing or penalized splines

\begin{center}
$PSS = \sum_{i=1}^n (y_i-\hat{y}_i)^2 + \lambda \int f^{\prime \prime}(x)dx$
\end{center}

- $f^{\prime \prime}(x)$ describes how smooth the curve is (high values are indicative of a lot of 'wigglyness') 
...

- $\lambda$ is a tuning parameter that determines the penalty for `smoothness' (larger values will result in less 'wigglyness')
    - $\lambda \rightarrow \infty$ will result in a straight line.
    
    
## How to determine $\lambda$?

Cross validation: 

\begin{center}
$V_o = \frac{1}{n}\sum_{i=1}^n(Y_i - \hat{f}^{[-i]}(x_i))^2$
\end{center}

where $\hat{f}^{[-i]}(x_i)$ is the fit of the model using all observations except for observation $i$.

In practice, there are mathematical expressions/approximations that allow us to choose $\lambda$ without fitting the model $n$ times.

## GAM in `mgcv` package




::: {.cell layout-align="center"}

```{.r .cell-code}
library(mgcv)
sfit<-gam(Species~s(logarea), data=gala)
summary(sfit)
```

::: {.cell-output .cell-output-stdout}

```

Family: gaussian 
Link function: identity 

Formula:
Species ~ s(logarea)

Parametric coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)    87.34      11.11   7.864 2.76e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
             edf Ref.df     F p-value    
s(logarea) 2.465  3.107 24.86  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.734   Deviance explained = 75.8%
GCV = 4062.7  Scale est. = 3577.3    n = 29
```


:::
:::



## GAM




::: {.cell layout-align="center"}

```{.r .cell-code}
plot(sfit, scheme=1)
```
:::



\begin{center}
\includegraphics[width=2.5 in]{figure/gamfit-1}
\end{center}

 
## GAM Diagnostics




::: {.cell layout-align="center"}

```{.r .cell-code}
gam.check(sfit)
```

::: {.cell-output .cell-output-stdout}

```

Method: GCV   Optimizer: magic
Smoothing parameter selection converged after 6 iterations.
The RMS GCV score gradient at convergence was 0.0002855077 .
The Hessian was positive definite.
Model rank =  10 / 10 

Basis dimension (k) checking results. Low p-value (k-index<1) may
indicate that k is too low, especially if edf is close to k'.

             k'  edf k-index p-value
s(logarea) 9.00 2.47    1.43    0.96
```


:::
:::



## GAM Diagnostics 

\begin{center}
\includegraphics[width=2.5 in]{figure/gamd-1}
\end{center}


---></p>
</div>
</section>
<section id="other-considerations" class="slide level2">
<h2>Other considerations</h2>
<p>What if you want to allow for multiple non-linear relationships?</p>
<ul>
<li><code>ns(x1, 3)  + ns(x2, 4)</code> or multiple smoothing splines</li>
</ul>
<div class="fragment">
<ul>
<li>Other basis functions can be used to fit “smooth surfaces” (allowing for interactions between variables)
<ul>
<li>tensor splines, thin plate splines, etc…</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Can include interactions (separate smooth for each level of a categorical variable)</li>
</ul>
<!---
## Inference

Because we used the data to choose $\lambda$ (and effective model degrees of freedom):

- p-values can be misleading (remember our earlier discussion of model-selection)
- Wood (2006) Generalized Additive Models, suggests p-values are often too small (multiply p times 2)

See discussion in ch 3.6 of Zuur et al. 
...


Perhaps a reason to prefer regression splines?  

    
--->
</div>
</section>
<section id="black-bear-movement-and-heart-rates" class="slide level2 smaller">
<h2>Black Bear Movement and Heart Rates</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Graphics/bear.jpg" class="quarto-figure quarto-figure-center" style="width:60.0%" alt="Picture of a black bear"></p>
</figure>
</div>
</div>
</div>
<p>There are cyclical splines that<br>
ensure ends meet at 0 and 24 hours<br>
(or, Jan 1 and Dec 31).</p>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Graphics/movenl.jpg" class="quarto-figure quarto-figure-center" style="height:100.0%" alt="Smooth trends in black bear movement rates estimated using cyclical cubic splines to ensure the ends of the curves meet at 0 and 24 hours." width="223"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="non-linear-models-with-mechanistic-basis" class="slide level2">
<h2>Non-Linear Models with Mechanistic Basis</h2>
<p><span class="math inline">\(Y \sim f(x,\beta)\)</span>, where <span class="math inline">\(f(x,\beta)\)</span> may have a strong theoretical motivation.</p>
<ul>
<li>Ricker model for stock-recruitment: <span class="math inline">\(S_{t+1} = S_te^{r(1-\beta S_t)}\)</span><br>
</li>
<li>Predator prey: <span class="math inline">\(f(N) = \frac{aN}{1+ahN}\)</span></li>
</ul>
<p>We will eventually learn how to fit these models using Maximum likelihood and Bayesian methods.</p>
<!---

## Raw versus Orthogonal Polynomials




::: {.cell layout-align="center"}

```{.r .cell-code}
lm.poly.raw<-lm(Species~poly(logarea,2, raw=TRUE), data=gala)
lm.poly.orth<-lm(Species~poly(logarea,2), data=gala)
plot(fitted(lm.poly.raw), fitted(lm.poly.orth), xlab="Normal Polynomials",
     ylab="orthogonal Polynomials")
abline(0,1)
```
:::



\begin{center}
\includegraphics[width=2 in]{figure/poly-1}
\end{center}



## 




::: {.cell layout-align="center"}

```{.r .cell-code}
Anova(lm.poly1.raw) #log(Area)+ I(log(Area)^2)
```

::: {.cell-output .cell-output-stdout}

```
Anova Table (Type II tests)

Response: Species
                 Sum Sq Df F value    Pr(>F)    
poly(logarea, 2) 283970  2  39.596 1.285e-08 ***
Residuals         93232 26                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


:::
:::



...



::: {.cell layout-align="center"}

```{.r .cell-code}
Anova(lm.poly.orth) # poly(logarea,2)
```

::: {.cell-output .cell-output-stdout}

```
Anova Table (Type II tests)

Response: Species
                 Sum Sq Df F value    Pr(>F)    
poly(logarea, 2) 283970  2  39.596 1.285e-08 ***
Residuals         93232 26                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


:::
:::



## Polynomials




::: {.cell layout-align="center"}

```{.r .cell-code}
head(poly(gala$logarea,2), 3)
```

::: {.cell-output .cell-output-stdout}

```
              1         2
[1,] -0.3425801 0.4850314
[2,] -0.2828395 0.2782420
[3,] -0.2550617 0.1950582
```


:::

```{.r .cell-code}
head(cbind(gala$logarea, gala$logarea^2),3)
```

::: {.cell-output .cell-output-stdout}

```
          [,1]      [,2]
[1,] -4.605170 21.207592
[2,] -3.506558 12.295948
[3,] -2.995732  8.974412
```


:::
:::



\normalsize
Raw and orthogonal polynomials use different [basis vectors]{style="color:red;"}, result in different parameter estimates, but the same fitted values! 
...


Both [span]{style="color:red;"} the set of all quadratic polynomial functions (for more, see Hefley et al. 2017 on Moodle)

##




::: {.cell layout-align="center"}

:::




\begin{center}
\includegraphics[width=4.5 in]{figure/polybais-1}
\end{center}
--->
<!---
# Advantages of poly versus including x and $x^2$
--->
<!--- 
## Advantages of using the poly function 




::: {.cell layout-align="center"}

```{.r .cell-code}
lm.poly<-lm(Species~ logarea+ I(logarea^2), data=gala)
summary(lm.poly)
```

::: {.cell-output .cell-output-stdout}

```

Call:
lm(formula = Species ~ logarea + I(logarea^2), data = gala)

Residuals:
     Min       1Q   Median       3Q      Max 
-151.009  -27.361   -1.033   20.825  178.805 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)   14.1530    14.5607   0.972 0.340010    
logarea       12.6226     4.8614   2.596 0.015293 *  
I(logarea^2)   3.5641     0.9445   3.773 0.000842 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 59.88 on 26 degrees of freedom
Multiple R-squared:  0.7528,    Adjusted R-squared:  0.7338 
F-statistic:  39.6 on 2 and 26 DF,  p-value: 1.285e-08
```


:::
:::



## Polynomials: component + residual plot



::: {.cell layout-align="center"}

```{.r .cell-code}
par(mfrow=c(1,2))
termplot(lm.poly, se=T, partial=T, pch=16)
```
:::




\begin{center}
\includegraphics[width=4.5 in]{figure/poly2-1} 
\end{center}

## Polynomials: component + residual plot



::: {.cell layout-align="center"}

```{.r .cell-code}
lm.poly1.raw<-lm(Species~ poly(logarea,2), data=gala)
termplot(lm.poly1.raw, se=T, partial=T, pch=16)
```
:::



\begin{center}
\includegraphics[width=2 in]{figure/poly2b-1} 
\end{center}
 




## Hypothesis Testing


 


::: {.cell layout-align="center"}

```{.r .cell-code}
library(car)
Anova(lm.poly) #log(Area)+ I(log(Area)^2)
```

::: {.cell-output .cell-output-stdout}

```
Anova Table (Type II tests)

Response: Species
             Sum Sq Df F value    Pr(>F)    
logarea       24175  1  6.7417 0.0152925 *  
I(logarea^2)  51058  1 14.2387 0.0008418 ***
Residuals     93232 26                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


:::
:::



...



::: {.cell layout-align="center"}

```{.r .cell-code}
Anova(lm.poly1.raw) # poly(logarea,2)
```

::: {.cell-output .cell-output-stdout}

```
Anova Table (Type II tests)

Response: Species
                 Sum Sq Df F value    Pr(>F)    
poly(logarea, 2) 283970  2  39.596 1.285e-08 ***
Residuals         93232 26                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


:::
:::


 
<!--- 
## geom_smooth() in ggplot

\hush{\texttt{?geom\_smooth} } 

\hush{\textbf{method}

smoothing method (function) to use, eg. lm, glm, gam, loess, rlm. For datasets with n $<$ 1000 default is loess. For datasets with 1000 or more observations defaults to gam, see gam for more details.}  

- `loess` = locally weighted regression (see chapter 3 of Zuur et al.)  
- Always good idea to look at examples at bottom of the help page!

--->

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="L04_Non-linearModels_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="L04_Non-linearModels_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>